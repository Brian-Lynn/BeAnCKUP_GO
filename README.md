# BeAnCKUP - 功能强大、性能卓越的桌面备份工具

## 🚀 项目简介

BeAnCKUP 是一款基于 Go + Wails 开发的现代化桌面备份工具，采用模块化架构设计，具备高性能、高可靠性和优秀的用户体验。

## ✨ 核心特性

### 🛡️ 数据安全与完整性
- **SHA-256 哈希校验**：所有文件均通过 SHA-256 进行内容校验
- **智能去重**：基于内容哈希的去重存储，节省存储空间
- **数据完整性保证**：清单文件嵌入备份数据，避免单点故障

### ⚡ 高性能架构
- **动态内存管理**：根据系统内存状况自动调整缓冲区大小
- **智能文件分流**：小文件内存处理，大文件流式处理
- **并发工作池**：多协程并行处理，最大化 I/O 性能
- **7z 压缩核心**：使用 LZMA 算法，高压缩比

### 🎯 用户体验
- **驾驶舱式 UI**：三栏式布局，信息聚合展现
- **实时状态反馈**：进度条、速度监控、状态指示
- **断点续传**：任务中断后可从断点恢复
- **时光机功能**：备份历史浏览，选择性恢复

## 🏗️ 技术架构

### 后端模块 (Go)

```
backend/
├── types/              # 共享类型定义
├── task_manager/       # 任务管理器 - 总指挥
├── resource_manager/   # 资源管理器 - 动态内存管理
├── indexer/           # 索引器 - 变更检测
├── file_processor/    # 文件处理器 - 智能分流
├── worker/            # 工作池 - 并发处理
├── packager/          # 打包器 - 7z 压缩
├── manifest_manager/  # 清单管理器 - 元数据管理
└── state_manager/     # 状态管理器 - 断点续传
```

### 前端界面 (HTML/CSS/JavaScript)
- **单窗口应用**：基于 Wails 的桌面应用
- **响应式设计**：适配不同屏幕尺寸
- **现代化 UI**：渐变背景、圆角设计、动画效果

## 📦 项目结构

```
BeAnCKUP_NEW/
├── main.go                    # 主程序入口
├── go.mod                     # Go 模块定义
├── go.sum                     # 依赖校验
├── README.md                  # 项目说明
├── backend/                   # 后端模块
│   ├── types/                 # 共享类型
│   ├── task_manager/          # 任务管理
│   ├── resource_manager/      # 资源管理
│   ├── indexer/              # 索引器
│   ├── file_processor/       # 文件处理
│   ├── worker/               # 工作池
│   ├── packager/             # 打包器
│   ├── manifest_manager/     # 清单管理
│   └── state_manager/        # 状态管理
└── frontend/                 # 前端资源
    └── index.html            # 主界面
```

## 🚀 快速开始

### 环境要求
- Go 1.21+
- Wails v2
- Windows 10+ / macOS / Linux

### 安装依赖
```bash
# 安装 Wails CLI
go install github.com/wailsapp/wails/v2/cmd/wails@latest

# 安装项目依赖
go mod tidy
```

### 开发模式运行
```bash
# 启动开发服务器
wails dev
```

### 构建发布版本
```bash
# 构建应用
wails build

# 构建并打包
wails build -package
```

## 🎯 核心设计哲学

### 1. 健壮性优先
- 每次备份生成独立的 .7z 归档包
- 清单文件嵌入备份数据，避免单点故障
- 断点续传机制，任务中断可恢复

### 2. 智能高性能
- 动态感知系统内存状况
- 自动调整内部缓冲区大小
- 海量小文件极致 I/O 性能

### 3. 数据完整性与去重
- SHA-256 哈希内容校验
- 只备份真正新增或修改的数据
- 基于内容的智能去重

### 4. 用户体验至上
- 单窗口、三栏式"驾驶舱"布局
- 核心信息聚合展现
- 操作流程线性、直观

## 🔧 模块详解

### Task Manager (任务管理器)
- **职责**：UI 与后端引擎的唯一接口
- **功能**：接收 UI 指令，管理备份/恢复任务生命周期
- **接口**：StartBackup, PauseBackup, ResumeBackup, CancelBackup

### Resource Manager (资源管理器)
- **职责**：动态计算小文件处理阈值
- **算法**：Max(Min(50%可用内存, 15%总内存, 4GB上限), 64MB保底)
- **功能**：实时监控系统资源状况

### Indexer (索引器)
- **职责**：扫描工作区，找出需要处理的文件
- **策略**：对比文件路径、大小、修改时间
- **输出**："嫌疑人"列表（新增、修改、可能移动的文件）

### File Processor (文件处理器)
- **职责**：对"嫌疑人"进行分流和预处理
- **决策**：根据文件大小与阈值比较
- **处理**：小文件读入内存，大文件记录路径

### Worker Pool (工作池)
- **职责**：并发完成哈希计算、去重决策和数据压缩
- **特性**：可配置并发数量，任务队列管理
- **流程**：计算哈希 → 去重检查 → 压缩打包

### Packager (打包器)
- **职责**：创建和写入独立的 .7z 归档包
- **监控**：包大小限制，自动分卷
- **格式**：S002-xxxx-E01.7z

### Manifest Manager (清单管理器)
- **职责**：维护内存中的实时清单
- **功能**：查询接口、更新接口、持久化
- **存储**：JSON 格式，嵌入最后一个 .7z 包

### State Manager (状态管理器)
- **职责**：任务的中断与恢复
- **存储**：.beanckup/session.json
- **功能**：断点续传，会话状态持久化

## 🎨 UI/UX 设计

### 备份模式 (三栏式)
1. **第一栏 (左)**：工作区浏览器
   - 当前工作区路径
   - 带引导线的目录树
   - 状态反馈（橙色高亮、旋转加载、绿色对勾）

2. **第二栏 (中)**：交付日志
   - 可折叠的 Series 列表
   - Episode 包状态显示
   - 独立进度条

3. **第三栏 (右)**：任务控制台
   - 设置区（包大小上限、任务总量上限）
   - 监控区（总进度、速度、耗时）
   - 操作区（扫描变更、开始备份、暂停/取消）

### 恢复模式 (三栏式)
1. **第一栏 (左)**：备份历史 (时光机)
   - 按时间倒序的 Series 列表
   - 点击更新右侧两栏

2. **第二栏 (中)**：文件浏览器
   - 选定时间点的文件目录树
   - 文件和文件夹复选框

3. **第三栏 (右)**：恢复控制台
   - 配置区（恢复路径、冲突处理）
   - 摘要区（已选文件数量、预估大小）
   - 操作区（开始恢复）

## 🔮 未来规划

### 短期目标
- [ ] 完善 7z SDK 集成
- [ ] 实现完整的备份/恢复流程
- [ ] 优化 UI 界面和交互体验
- [ ] 添加配置管理功能

### 中期目标
- [ ] 支持增量备份
- [ ] 添加备份加密功能
- [ ] 实现备份验证和修复
- [ ] 支持云存储集成

### 长期目标
- [ ] 分布式备份支持
- [ ] 实时同步功能
- [ ] 跨平台优化
- [ ] 企业级功能

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境设置
1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

### 代码规范
- 遵循 Go 官方代码规范
- 添加适当的注释和文档
- 编写单元测试
- 保持代码简洁和可读性

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

## 👥 团队

- **项目代号**：BeAnCKUP
- **开发语言**：Go + Wails
- **压缩核心**：7z (LZMA)
- **设计理念**：健壮性优先，智能高性能，用户体验至上

---

**BeAnCKUP** - 让数据备份变得简单、高效、可靠！ 🚀 